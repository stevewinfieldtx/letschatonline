<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatCharacters - Intelligent Conversations</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .chat-photo-frame {
            width: 300px;
            height: 400px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            position: relative;
        }
        .chat-photo {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 0.5s ease-in-out;
        }
        .memory-indicator {
            animation: pulse 2s infinite;
        }
        .message-bubble {
            max-width: 70%;
            word-wrap: break-word;
        }
        .photo-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
            color: white;
            padding: 10px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const ChatCharacters = () => {
            const [currentView, setCurrentView] = useState('profiles');
            const [selectedCharacter, setSelectedCharacter] = useState(null);
            const [characters, setCharacters] = useState({});
            const [messages, setMessages] = useState([]);
            const [userMessage, setUserMessage] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [settings, setSettings] = useState({
                apiKey: '',
                model: 'meta-llama/llama-3.1-70b-instruct:free',
                isOpen: false
            });
            const [tokens, setTokens] = useState(50);

            // Memory System States
            const [tenMinuteNotes, setTenMinuteNotes] = useState([]);
            const [sessionMemory, setSessionMemory] = useState([]);
            const [lastMemoryCheck, setLastMemoryCheck] = useState(Date.now());
            const [conversationStartTime, setConversationStartTime] = useState(null);

            // Photo Display States
            const [currentPhotoIndex, setCurrentPhotoIndex] = useState(0);
            const [photoRotationEnabled, setPhotoRotationEnabled] = useState(true);

            const messagesEndRef = useRef(null);

            // Scroll to bottom of messages
            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages]);

            // Photo rotation effect
            useEffect(() => {
                if (!selectedCharacter || !photoRotationEnabled) return;
                
                const character = characters[selectedCharacter];
                if (!character?.profileImages || character.profileImages.length <= 1) return;

                const interval = setInterval(() => {
                    setCurrentPhotoIndex(prev => 
                        (prev + 1) % character.profileImages.length
                    );
                }, 4000); // Change photo every 4 seconds

                return () => clearInterval(interval);
            }, [selectedCharacter, characters, photoRotationEnabled]);

            // Memory System - 10 Minute Analysis
            useEffect(() => {
                if (currentView !== 'chat' || messages.length < 2) return;

                const checkMemory = () => {
                    const now = Date.now();
                    const timeSinceLastCheck = now - lastMemoryCheck;
                    
                    // Check every 10 minutes (600000ms)
                    if (timeSinceLastCheck >= 600000) {
                        analyzeConversationForMemory();
                        setLastMemoryCheck(now);
                    }
                };

                const interval = setInterval(checkMemory, 60000); // Check every minute
                return () => clearInterval(interval);
            }, [messages, lastMemoryCheck, currentView]);

            // Analyze conversation for memory creation
            const analyzeConversationForMemory = async () => {
                const recentMessages = messages.slice(-20); // Last 20 messages
                const conversationText = recentMessages
                    .map(msg => `${msg.sender}: ${msg.text}`)
                    .join('\n');

                const memoryPrompt = `Analyze this conversation and extract key memories. Look for:
- Life events (jobs, moving, relationships, achievements)
- Emotional moments (fights, celebrations, bad days, good days)
- Activities (parties, cooking plans, vacations, hobbies)
- Personal details (jokes, stories, preferences, health)
- Future plans or commitments

Conversation:
${conversationText}

Create a concise memory note (under 150 words) of the most important topics discussed:`;

                try {
                    const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                        method: "POST",
                        headers: {
                            "Authorization": `Bearer ${settings.apiKey}`,
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            model: settings.model,
                            messages: [
                                { role: "user", content: memoryPrompt }
                            ],
                            max_tokens: 200
                        })
                    });

                    const data = await response.json();
                    const memoryNote = data.choices[0].message.content;

                    setTenMinuteNotes(prev => [...prev, {
                        timestamp: Date.now(),
                        content: memoryNote,
                        messageCount: messages.length
                    }]);

                } catch (error) {
                    console.error('Memory analysis failed:', error);
                }
            };

            // Load session memory for character
            const loadCharacterMemory = (characterKey) => {
                const memoryKey = `memory_${characterKey}_${getUserId()}`;
                const savedMemory = localStorage.getItem(memoryKey);
                
                if (savedMemory) {
                    try {
                        const memory = JSON.parse(savedMemory);
                        setSessionMemory(memory.sessions || []);
                        return memory.sessions;
                    } catch (error) {
                        console.error('Failed to load memory:', error);
                    }
                }
                return [];
            };

            // Save session memory
            const saveSessionMemory = (characterKey, sessions) => {
                const memoryKey = `memory_${characterKey}_${getUserId()}`;
                const memoryData = {
                    sessions,
                    lastUpdated: Date.now()
                };
                localStorage.setItem(memoryKey, JSON.stringify(memoryData));
            };

            // Get user ID (simple implementation)
            const getUserId = () => {
                let userId = localStorage.getItem('chatcharacters_user_id');
                if (!userId) {
                    userId = 'user_' + Math.random().toString(36).substr(2, 9);
                    localStorage.setItem('chatcharacters_user_id', userId);
                }
                return userId;
            };

            // Create session summary when chat ends
            const createSessionSummary = async () => {
                if (tenMinuteNotes.length === 0) return;

                const notesText = tenMinuteNotes
                    .map(note => note.content)
                    .join('\n\n');

                const summaryPrompt = `Summarize these conversation highlights into a single session memory (under 300 words):

${notesText}

Create a comprehensive summary that captures the key relationship developments, personal details shared, and important topics discussed:`;

                try {
                    const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                        method: "POST",
                        headers: {
                            "Authorization": `Bearer ${settings.apiKey}`,
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            model: settings.model,
                            messages: [
                                { role: "user", content: summaryPrompt }
                            ],
                            max_tokens: 400
                        })
                    });

                    const data = await response.json();
                    const sessionSummary = data.choices[0].message.content;

                    const newSession = {
                        id: Date.now(),
                        date: new Date().toISOString().split('T')[0],
                        summary: sessionSummary,
                        tokens: sessionSummary.length,
                        tenMinuteNotes: tenMinuteNotes.length,
                        messageCount: messages.length,
                        duration: Date.now() - conversationStartTime
                    };

                    const updatedSessions = [newSession, ...sessionMemory];
                    setSessionMemory(updatedSessions);
                    saveSessionMemory(selectedCharacter, updatedSessions);

                } catch (error) {
                    console.error('Session summary failed:', error);
                }
            };

            // Load characters (fallback to support character)
            useEffect(() => {
                setCharacters({
                    support: {
                        name: "Support",
                        age: 25,
                        occupation: "Platform Assistant",
                        location: "ChatCharacters HQ",
                        description: "Friendly assistant helping you connect",
                        avatar: "üí¨",
                        profileImages: [
                            "https://images.unsplash.com/photo-1494790108755-2616b612b47c?w=400&h=600&fit=crop&crop=face",
                            "https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=400&h=600&fit=crop&crop=face",
                            "https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=400&h=600&fit=crop&crop=face"
                        ],
                        interests: ["Helping Others", "Technology", "Conversations"],
                        personality: "Helpful and understanding",
                        lookingFor: "Ways to help you have a great experience",
                        prompt: "You are a friendly support assistant for ChatCharacters platform. Be helpful, professional, and engaging."
                    }
                });
            }, []);

            const startChatWith = (characterKey) => {
                setSelectedCharacter(characterKey);
                setCurrentView('chat');
                setCurrentPhotoIndex(0);
                setConversationStartTime(Date.now());
                setLastMemoryCheck(Date.now());
                setTenMinuteNotes([]);

                // Load character memory
                const memory = loadCharacterMemory(characterKey);
                
                const character = characters[characterKey];
                const memoryContext = memory.length > 0 ? 
                    `\n\nYour memory of previous conversations with this user:\n${memory.slice(0, 3).map(s => s.summary).join('\n\n')}` : 
                    '\n\nThis is your first conversation with this user.';

                const welcomeMessage = character.name === "Support" ?
                    "Gosh, I have no clue what happened to the other characters. I'll let them know you tried to reach them. In the meantime, why don't you and I chat a little bit?" :
                    memory.length > 0 ? 
                        "Hey! Great to see you again! üòä How have you been?" :
                        `Hi there! I'm ${character.name}. ${character.description} Let's chat! üíï`;

                setMessages([{
                    sender: character.name,
                    text: welcomeMessage,
                    timestamp: Date.now()
                }]);
            };

            const sendMessage = async () => {
                if (!userMessage.trim() || isLoading) return;
                if (tokens <= 0) {
                    alert('No tokens remaining! Please purchase more to continue chatting.');
                    return;
                }

                const newUserMessage = {
                    sender: 'You',
                    text: userMessage,
                    timestamp: Date.now()
                };

                setMessages(prev => [...prev, newUserMessage]);
                setUserMessage('');
                setIsLoading(true);
                setTokens(prev => Math.max(0, prev - 1));

                const character = characters[selectedCharacter];
                const recentMessages = [...messages, newUserMessage].slice(-10);
                const conversationHistory = recentMessages
                    .map(msg => ({ role: msg.sender === 'You' ? 'user' : 'assistant', content: msg.text }))
                    .slice(0, -1);

                // Add memory context
                const memoryContext = sessionMemory.length > 0 ? 
                    `Previous conversations: ${sessionMemory.slice(0, 3).map(s => s.summary).join(' ')}` : 
                    'First conversation with this user.';

                const tenMinuteContext = tenMinuteNotes.length > 0 ?
                    `Recent conversation highlights: ${tenMinuteNotes.slice(-2).map(n => n.content).join(' ')}` : '';

                const systemPrompt = `${character.prompt}

Memory Context: ${memoryContext}
${tenMinuteContext}

Respond naturally and reference past conversations when relevant. Keep responses under 100 words unless the topic requires more detail.`;

                try {
                    const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                        method: "POST",
                        headers: {
                            "Authorization": `Bearer ${settings.apiKey}`,
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            model: settings.model,
                            messages: [
                                { role: "system", content: systemPrompt },
                                ...conversationHistory,
                                { role: "user", content: userMessage }
                            ],
                            max_tokens: 150
                        })
                    });

                    const data = await response.json();
                    const aiResponse = data.choices[0].message.content;

                    setMessages(prev => [...prev, {
                        sender: character.name,
                        text: aiResponse,
                        timestamp: Date.now()
                    }]);

                } catch (error) {
                    setMessages(prev => [...prev, {
                        sender: character.name,
                        text: "Sorry, I'm having trouble connecting right now. Please check your API settings! üíî",
                        timestamp: Date.now()
                    }]);
                    setTokens(prev => prev + 1); // Refund token on error
                }

                setIsLoading(false);
            };

            const endChat = () => {
                if (tenMinuteNotes.length > 0) {
                    createSessionSummary();
                }
                setCurrentView('profiles');
                setSelectedCharacter(null);
                setMessages([]);
                setTenMinuteNotes([]);
            };

            // Profiles View
            if (currentView === 'profiles') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900">
                        {/* Header */}
                        <div className="bg-gradient-to-r from-purple-600 to-blue-600 text-white p-6">
                            <div className="max-w-6xl mx-auto flex justify-between items-center">
                                <div>
                                    <h1 className="text-4xl font-bold">üí¨ ChatCharacters</h1>
                                    <p className="text-xl opacity-90">Connect with any character, anytime</p>
                                </div>
                                <div className="flex items-center space-x-4">
                                    <div className="text-right">
                                        <div className="text-lg font-semibold">ü™ô {tokens} tokens</div>
                                        <div className="text-sm opacity-75">Photos: $0.50 ‚Ä¢ Chat: $5/hour</div>
                                    </div>
                                    <button 
                                        onClick={() => setSettings(prev => ({...prev, isOpen: !prev.isOpen}))}
                                        className="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-all"
                                    >
                                        ‚öôÔ∏è Settings
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* Settings Panel */}
                        {settings.isOpen && (
                            <div className="bg-white bg-opacity-10 backdrop-blur-sm border-b border-white border-opacity-20 p-6">
                                <div className="max-w-6xl mx-auto">
                                    <h3 className="text-white text-xl mb-4">‚öôÔ∏è Platform Settings</h3>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-white text-sm mb-2">OpenRouter API Key:</label>
                                            <input
                                                type="password"
                                                value={settings.apiKey}
                                                onChange={(e) => setSettings(prev => ({...prev, apiKey: e.target.value}))}
                                                className="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-white placeholder-opacity-60"
                                                placeholder="sk-or-..."
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-white text-sm mb-2">AI Model:</label>
                                            <select
                                                value={settings.model}
                                                onChange={(e) => setSettings(prev => ({...prev, model: e.target.value}))}
                                                className="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white"
                                            >
                                                <option value="meta-llama/llama-3.1-70b-instruct:free">Llama 3.1 70B (Free)</option>
                                                <option value="meta-llama/llama-3.1-70b-instruct">Llama 3.1 70B ($)</option>
                                                <option value="anthropic/claude-3-haiku">Claude 3 Haiku ($)</option>
                                                <option value="anthropic/claude-3.5-sonnet">Claude 3.5 Sonnet ($$)</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Character Profiles */}
                        <div className="max-w-6xl mx-auto p-8">
                            <h2 className="text-3xl font-bold text-white text-center mb-8">
                                {Object.keys(characters).length === 1 && characters.support ? 
                                    "Support Available" : "Choose Your Character"
                                }
                            </h2>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                                {Object.entries(characters).map(([key, character]) => (
                                    <div key={key} className="bg-white bg-opacity-10 backdrop-blur-sm rounded-2xl p-6 border border-white border-opacity-20 hover:bg-opacity-20 transition-all duration-300">
                                        {/* Photo Gallery */}
                                        <div className="relative mb-6">
                                            <div className="w-full h-80 rounded-xl overflow-hidden shadow-lg">
                                                <img
                                                    src={character.profileImages?.[0] || "https://images.unsplash.com/photo-1494790108755-2616b612b47c?w=400&h=600&fit=crop&crop=face"}
                                                    alt={character.name}
                                                    className="w-full h-full object-cover"
                                                />
                                            </div>
                                            
                                            {/* Photo count badge */}
                                            {character.profileImages && character.profileImages.length > 1 && (
                                                <div className="absolute top-3 left-3 bg-black bg-opacity-60 text-white px-2 py-1 rounded-lg text-sm">
                                                    üì∏ {character.profileImages.length} photos
                                                </div>
                                            )}
                                            
                                            {/* Support badge */}
                                            {key === 'support' && (
                                                <div className="absolute top-3 right-3 bg-yellow-500 bg-opacity-90 text-black px-2 py-1 rounded-lg text-sm font-semibold">
                                                    ‚ö†Ô∏è Temporary Assistant
                                                </div>
                                            )}
                                        </div>

                                        {/* Character Info */}
                                        <div className="text-center mb-6">
                                            <h3 className="text-2xl font-bold text-white mb-2">
                                                {character.name} {character.avatar || 'üíï'}
                                            </h3>
                                            {character.age && (
                                                <div className="inline-block bg-purple-500 bg-opacity-60 text-white px-3 py-1 rounded-full text-sm mb-3">
                                                    {character.age} years old
                                                </div>
                                            )}
                                        </div>

                                        {/* Details */}
                                        <div className="space-y-3 mb-6">
                                            {character.location && (
                                                <div className="flex items-center text-white text-sm">
                                                    <span className="mr-2">üìç</span>
                                                    {character.location}
                                                </div>
                                            )}
                                            {character.occupation && (
                                                <div className="flex items-center text-white text-sm">
                                                    <span className="mr-2">üíº</span>
                                                    {character.occupation}
                                                </div>
                                            )}
                                            {character.personality && (
                                                <div className="flex items-center text-white text-sm">
                                                    <span className="mr-2">üí≠</span>
                                                    {character.personality}
                                                </div>
                                            )}
                                            {character.lookingFor && (
                                                <div className="flex items-center text-white text-sm">
                                                    <span className="mr-2">üéØ</span>
                                                    {character.lookingFor}
                                                </div>
                                            )}
                                        </div>

                                        <div className="text-center mb-6">
                                            <p className="text-white text-lg italic">"{character.description}"</p>
                                        </div>

                                        {/* Interests */}
                                        {character.interests && (
                                            <div className="mb-6">
                                                <h4 className="text-white font-semibold mb-3">Interests:</h4>
                                                <div className="flex flex-wrap gap-2">
                                                    {character.interests.map((interest, idx) => (
                                                        <span key={idx} className="bg-blue-500 bg-opacity-60 text-white px-3 py-1 rounded-full text-sm">
                                                            {interest}
                                                        </span>
                                                    ))}
                                                </div>
                                            </div>
                                        )}

                                        {/* Chat Button */}
                                        <button
                                            onClick={() => startChatWith(key)}
                                            className="w-full bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 text-lg"
                                        >
                                            {key === 'support' ? 'üÜò Chat with Support' : `üí¨ Start Chatting with ${character.name}`}
                                        </button>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Footer */}
                        <div className="text-center text-white py-8">
                            <p className="text-lg">ChatCharacters - Where connections come to life</p>
                        </div>
                    </div>
                );
            }

            // Chat View
            const character = characters[selectedCharacter];
            if (!character) return <div>Loading...</div>;

            return (
                <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex">
                    {/* Chat Photo Display */}
                    <div className="w-80 bg-black bg-opacity-30 p-6 flex flex-col">
                        <div className="mb-4">
                            <button
                                onClick={endChat}
                                className="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg transition-all mb-4"
                            >
                                ‚Üê Back to Characters
                            </button>
                        </div>

                        {/* Character Photo Frame */}
                        <div className="chat-photo-frame mx-auto mb-6">
                            <img
                                src={character.profileImages?.[currentPhotoIndex] || character.profileImages?.[0] || "https://images.unsplash.com/photo-1494790108755-2616b612b47c?w=400&h=600&fit=crop&crop=face"}
                                alt={character.name}
                                className="chat-photo"
                            />
                            <div className="photo-overlay">
                                <div className="font-semibold">{character.name}</div>
                                {character.profileImages && character.profileImages.length > 1 && (
                                    <div className="text-xs">
                                        Photo {currentPhotoIndex + 1} of {character.profileImages.length}
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Photo Controls */}
                        {character.profileImages && character.profileImages.length > 1 && (
                            <div className="mb-6">
                                <div className="flex justify-center space-x-2 mb-3">
                                    {character.profileImages.map((_, idx) => (
                                        <button
                                            key={idx}
                                            onClick={() => setCurrentPhotoIndex(idx)}
                                            className={`w-2 h-2 rounded-full transition-all ${
                                                idx === currentPhotoIndex ? 'bg-white' : 'bg-white bg-opacity-40'
                                            }`}
                                        />
                                    ))}
                                </div>
                                <div className="flex justify-center space-x-2">
                                    <button
                                        onClick={() => setCurrentPhotoIndex(prev => 
                                            prev === 0 ? character.profileImages.length - 1 : prev - 1
                                        )}
                                        className="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-3 py-1 rounded text-sm"
                                    >
                                        ‚óÄ
                                    </button>
                                    <button
                                        onClick={() => setPhotoRotationEnabled(!photoRotationEnabled)}
                                        className={`px-3 py-1 rounded text-sm transition-all ${
                                            photoRotationEnabled 
                                                ? 'bg-green-500 bg-opacity-60 text-white' 
                                                : 'bg-white bg-opacity-20 text-white hover:bg-opacity-30'
                                        }`}
                                    >
                                        {photoRotationEnabled ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'}
                                    </button>
                                    <button
                                        onClick={() => setCurrentPhotoIndex(prev => 
                                            (prev + 1) % character.profileImages.length
                                        )}
                                        className="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-3 py-1 rounded text-sm"
                                    >
                                        ‚ñ∂
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* Memory Status */}
                        <div className="bg-white bg-opacity-10 rounded-lg p-4 text-white text-sm">
                            <div className="memory-indicator mb-2">üß† Memory Status</div>
                            <div>Session Notes: {tenMinuteNotes.length}</div>
                            <div>Past Sessions: {sessionMemory.length}</div>
                            <div className="text-xs opacity-75 mt-2">
                                Next memory check: {Math.ceil((600000 - (Date.now() - lastMemoryCheck)) / 60000)}m
                            </div>
                        </div>
                    </div>

                    {/* Chat Interface */}
                    <div className="flex-1 flex flex-col">
                        {/* Chat Header */}
                        <div className="bg-gradient-to-r from-purple-600 to-blue-600 text-white p-4">
                            <div className="flex justify-between items-center">
                                <div>
                                    <h2 className="text-2xl font-bold">{character.name} {character.avatar}</h2>
                                    <p className="opacity-90">{character.description}</p>
                                </div>
                                <div className="text-right">
                                    <div className="text-lg font-semibold">ü™ô {tokens} tokens</div>
                                    <div className="text-sm opacity-75">10 tokens/hour ‚Ä¢ 1 token/photo</div>
                                </div>
                            </div>
                        </div>

                        {/* Messages */}
                        <div className="flex-1 overflow-y-auto p-6 space-y-4">
                            {messages.map((message, index) => (
                                <div key={index} className={`flex ${message.sender === 'You' ? 'justify-end' : 'justify-start'}`}>
                                    <div className={`message-bubble px-4 py-3 rounded-2xl ${
                                        message.sender === 'You' 
                                            ? 'bg-blue-500 text-white'
                                            : 'bg-white bg-opacity-20 text-white'
                                    }`}>
                                        <div className="font-semibold text-sm opacity-75 mb-1">
                                            {message.sender}
                                        </div>
                                        <div>{message.text}</div>
                                        <div className="text-xs opacity-60 mt-1">
                                            {new Date(message.timestamp).toLocaleTimeString()}
                                        </div>
                                    </div>
                                </div>
                            ))}
                            {isLoading && (
                                <div className="flex justify-start">
                                    <div className="bg-white bg-opacity-20 text-white px-4 py-3 rounded-2xl">
                                        <div className="flex items-center space-x-2">
                                            <div className="animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"></div>
                                            <span>{character.name} is typing...</span>
                                        </div>
                                    </div>
                                </div>
                            )}
                            <div ref={messagesEndRef} />
                        </div>

                        {/* Message Input */}
                        <div className="border-t border-white border-opacity-20 p-4">
                            <div className="flex space-x-3">
                                <input
                                    type="text"
                                    value={userMessage}
                                    onChange={(e) => setUserMessage(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
                                    placeholder={`Message ${character.name}...`}
                                    className="flex-1 p-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-white placeholder-opacity-60"
                                    disabled={isLoading}
                                />
                                <button
                                    onClick={sendMessage}
                                    disabled={isLoading || !userMessage.trim() || tokens <= 0}
                                    className="bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-3 px-6 rounded-lg transition-all"
                                >
                                    üíï Send
                                </button>
                            </div>
                            <div className="text-center text-white text-sm mt-2 opacity-75">
                                Chat costs 10 tokens per hour ‚Ä¢ {tokens} tokens remaining
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<ChatCharacters />, document.getElementById('root'));
    </script>
</body>
</html>